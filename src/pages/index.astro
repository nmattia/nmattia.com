---
// Index page, with a list of entries

import Default from "../components/Default.astro";

import { blogPostTeaser, getBlogEntries, blogEntryPath } from "../blog";
import { getCollection } from "astro:content";

// Common type of entries displayed on the front page
type Entry = {
  title: string;
  teaser: Promise<string>;
  target: "_self" | "_blank";
  image: string;
  link: string;
  date: Date;
};

// Blog entries
const blogEntries: Entry[] = (await getBlogEntries()).map((blogEntry) => ({
  title: blogEntry.data.title,
  teaser: blogPostTeaser(blogEntry),
  target: "_self",
  image: blogEntry.data.og_image,
  link: blogEntryPath(blogEntry),
  date: blogEntry.data.pubDate,
}));

// "Projects"
const projectsEntries: Entry[] = (
  await getCollection("projects", () => true)
).map((projectsEntry) => ({
  title: projectsEntry.data.title,
  teaser: Promise.resolve(projectsEntry.data.teaser),
  target: "_blank",
  image: projectsEntry.data.image,
  link: projectsEntry.data.link,
  date: projectsEntry.data.pubDate,
}));

const entries = blogEntries.concat(projectsEntries);
entries.sort((a, b) => b.date.getTime() - a.date.getTime());

const description =
  "Software Engineer based in Zurich who has a thing for functional programming, reproducible builds and infrastructure as code";
---

<Default ogType="website" description={description} path="/">
  <div class="intro">
    <h1>Nicolas Mattia</h1>

    <p>
      I'm a Software Engineer based in Zurich.<br />I like functional
      programming, reproducible builds and "Infrastructure as Code".
    </p>
  </div>

  <hr />

  <div class="blog" id="blog">
    <div class="blog-container">
      {
        entries.map((entry) => (
          <a
            target={entry.target}
            href={entry.link}
            style="text-decoration: none;"
          >
            <div class="card">
              <div class="card-container">
                <img
                  src={entry.image}
                  style="margin: auto; display: block; max-height: 630px;"
                />
                <h3>{entry.title}</h3>
                <div class="teaser">
                  <p set:html={entry.teaser} />
                </div>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</Default>
